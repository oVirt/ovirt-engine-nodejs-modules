= ovirt-engine-nodejs-modules

image:https://copr.fedorainfracloud.org/coprs/ovirt/ovirt-master-snapshot/package/ovirt-engine-nodejs-modules/status_image/last_build.png[link="https://copr.fedorainfracloud.org/coprs/ovirt/ovirt-master-snapshot/package/ovirt-engine-nodejs-modules/"]

== Summary

This package contains the dependencies needed to build oVirt JavaScript
applications.  By using this package, a project can use nodejs dependencies
and build without downloading packages.

== Usage

Modify your build script and/or CI job configuration to ensure this
packages is installed when building your project:

* `ovirt-engine-nodejs-modules`

It's highly recommended to specify an explicit version and release when
requiring the `ovirt-engine-nodejs-modules` package in your project.  For
example, in your `rpm.spec` file:

  BuildRequires: ovirt-engine-nodejs-modules >= 2.1.6-1

Note that `ovirt-engine-nodejs-modules` requires `nodejs` and takes care of
installing the `yarn` package manager.

== Build script

In your build script, source `setup-env.sh` to set up the Node.js environment
and run `yarn install` to populate the `./node_modules` directory:

  cd /path/to/your/project
  source /usr/share/ovirt-engine-nodejs-modules/setup-env.sh

The setup script runs `yarn install` in offline mode, using JavaScript
package sources located at:

  /usr/share/ovirt-engine-nodejs-modules/yarn-offline-cache

If the `setup-env.sh` command fails, it usually means that you need to add a
link:pre-seed/README.adoc[pre-seed] to or rebuild the `ovirt-engine-nodejs-modules`
RPM so its offline cache directory will be updated to contains all dependencies currently
required by your project.

== Using this package in a project

Simply modify the `projects.list` file, adding URL(s) referencing your
project's `package.json` file and the associated `yarn.lock` file.

Both `package.json` and `yarn.lock` are mandatory in the target project. The build
will fail if any of those files are not available.

== Package versioning

When changing the `projects.list` file, bump `.y` in `Version` and reset
the `Release` number.

When rebuilding the package to reflect changes in the consuming projects
(the ones listed in the `projects.list` file), or when adding a pre-seed,
bump `.z` in `Version` and reset the `Release` number.

For packaging related changes, simply bump the `Release` number.

== Pre-seed

If you need dependencies to build a patch or pull request where changes to
`package.json` or `yarn.lock` are not yet merged, you can add a manual pre-seed.
The avoids a chicken and egg problem.

See link:pre-seed/README.adoc[pre-seed README] for details.
